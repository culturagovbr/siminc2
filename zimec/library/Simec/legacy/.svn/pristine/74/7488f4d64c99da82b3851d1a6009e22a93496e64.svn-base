<?php

set_include_path(get_include_path() . PATH_SEPARATOR . APPRAIZ . DIRECTORY_SEPARATOR . 'zimec' . DIRECTORY_SEPARATOR . 'library');

/**
 * Abstract class for extension
 */
require_once APPRAIZ . 'zimec/library/Simec/Util.php';
require_once APPRAIZ . 'zimec/library/Zend/Date.php';
require_once APPRAIZ . 'zimec/library/Zend/View.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Element.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Title.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Input.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Data.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Select.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Textarea.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Options.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Radio.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Checkbox.php';
require_once APPRAIZ . 'zimec/library/Simec/View/Helper/Tab.php';

class Simec_View_Helper
{
    const K_FORM_TIPO_INLINE = 'INLINE';
    const K_FORM_TIPO_VERTICAL = 'VERTICAL';
    const K_FORM_TIPO_HORIZONTAL = 'HORIZONTAL';

	private static $view;

    protected $formTipo = self::K_FORM_TIPO_HORIZONTAL;
	
	public function __construct()
    {
		if (!Simec_View_Helper::$view) {
			Simec_View_Helper::$view = new Zend_View();
		}

		$this->title = new Simec_View_Helper_Title();
		$this->input = new Simec_View_Helper_Input();
		$this->data = new Simec_View_Helper_Data();
		$this->select = new Simec_View_Helper_Select();
		$this->textarea = new Simec_View_Helper_Textarea();
		$this->checkbox = new Simec_View_Helper_Checkbox();
		$this->radio = new Simec_View_Helper_Radio();
		$this->tab = new Simec_View_Helper_Tab();
	}

    /**
     * @return string
     */
    public function getFormTipo()
    {
        return $this->formTipo;
    }

    /**
     * @param string $formTipo
     */
    public function setFormTipo($formTipo)
    {
        $this->formTipo = $formTipo;
    }

	public function title($title, $subTitle = null, $attribs = array())
    {
		$this->title->setView(Simec_View_Helper::$view);
		return $this->title->title($title, $subTitle, $attribs);
	}
	
	public function input($name, $label = null, $value = null, $attribs = array(), $config = array())
    {
        $config = $this->montarConfig($config);
		$this->input->setView(Simec_View_Helper::$view);
		return $this->input->input($name, $label, $value, $attribs, $config);
	}

	public function data($name, $label = null, $value = null, $attribs = array(), $config = array())
    {
        $config = $this->montarConfig($config);
		$this->data->setView(Simec_View_Helper::$view);
		return $this->data->data($name, $label, $value, $attribs, $config);
	}

	public function select($name, $label = null, $value = null, $options = array(), $attribs = null, $config = array())
    {
        $config = $this->montarConfig($config);
        if(is_string($options)){
            global $db;
            $options = $db->carregar($options);
            $options = simec_preparar_array($options);
        }
		$this->select->setView(Simec_View_Helper::$view);
		return $this->select->select($name, $label, $value, $options, $attribs, $config);
	}
	
	public function textarea($name, $label = null, $value = null, $attribs = array(), $config = array())
    {
        $config = $this->montarConfig($config);
		$this->textarea->setView(Simec_View_Helper::$view);
		return $this->textarea->textarea($name, $label, $value, $attribs, $config);
	}
	
	public function radio($name, $label = null, $value = null, $options = null, $attribs = null, $config = array())
    {
        $config = $this->montarConfig($config);
		$this->radio->setView(Simec_View_Helper::$view);
		return $this->radio->radio($name, $label, $value, $options, $attribs, $config);
	}
	
	public function checkbox($name, $label = null, $value = null, $options = null, $attribs = array(), $config = array())
    {
        $config = $this->montarConfig($config);
		$this->checkbox->setView(Simec_View_Helper::$view);
		return $this->checkbox->checkbox($name, $label, $value, $options, $attribs, $config);
	}
	
	public function tab($itens = array(), $url = false, $config = array())
    {
		return $this->tab->tab($itens, $url, $config);
	}

	protected function montarConfig($config = array())
    {
        if(empty($config['formTipo'])){
            $config['formTipo'] = $this->formTipo;
        }
        return $config;
	}
}